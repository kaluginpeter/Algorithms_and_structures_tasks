
F. Префиксные хеши

Язык	Ограничение времени	Ограничение памяти	Ввод	Вывод

Все языки	1 секунда	128 Мб	стандартный ввод или input.txt	стандартный вывод или output.txt

Node.js 14.15.5	5 секунд	128 Мб

OpenJDK Java 11	2.5 секунд	128 Мб

C# (MS .NET 6.0 + ASP)	2.5 секунд	128 Мб

Java 21 (Temurin JDK)	2.5 секунд	128 Мб

Kotlin 1.8.0 (JRE 11)	2.5 секунд	128 Мб

Python 3.12.3	5 секунд	128 Мб

C# (MS .NET 5.0 + ASP)	2.5 секунд	128 Мб

Алла не остановилась на достигнутом –— теперь она хочет

научиться быстро вычислять хеши произвольных подстрок данной строки. Помогите ей!

На вход поступают запросы на подсчёт хешей разных подстрок.

Ответ на каждый запрос должен выполняться за O(1). 

Допустимо в начале работы программы сделать предподсчёт для дальнейшей работы со строкой.

Напомним, что полиномиальный хеш считается по формуле

h
(
s
)
=
(
s
1
a
n
−
1
+
s
2
a
n
−
2
+
⋯
+
s
n
−
1
a
+
s
n
)
 
m
o
d
 
m
h(s)=(s 
1
​
 a 
n−1
 +s 
2
​
 a 
n−2
 +⋯+s 
n−1
​
 a+s 
n
​
 ) mod m

В данной задаче необходимо использовать в качестве значений отдельных символов их коды в таблице ASCII.

Формат ввода
В первой строке дано число 
a
a (
1
≤
a
≤
1000
1≤a≤1000) –— основание, по которому считается хеш. Во второй строке дано число 
m
m (
1
≤
m
≤
1
0
7
1≤m≤10 
7
 ) –— модуль. В третьей строке дана строка 
s
s (
0
≤
∣
s
∣
≤
1
0
6
0≤∣s∣≤10 
6
 ), состоящая из больших и маленьких латинских букв.

В четвертой строке дано число запросов 
t
t –— натуральное число от 
1
1 до 
1
0
5
10 
5
 . В каждой из следующих t строк записаны через пробел два числа 
l
l и 
r
r –— индексы начала и конца очередной подстроки. (
1
≤
l
≤
r
≤
∣
s
∣
1≤l≤r≤∣s∣).

Формат вывода
Для каждого запроса выведите на отдельной строке хеш заданной в запросе подстроки.

Пример 1

Ввод	Вывод

1000


1000009

abcdefgh

7

1 1

1 5

2 3

3 4

4 4

1 8

5 8

97

225076

98099

99100

100

436420

193195

Пример 2

Ввод	Вывод

100

10

a

1

1 1

7

